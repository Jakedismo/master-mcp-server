<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>Phase 9 — Comprehensive Testing Architecture | Master MCP Server</title>
    <meta name="description" content="Aggregate and orchestrate multiple MCP servers behind one endpoint">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.BQrfSMzK.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CHJJO2XB.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.B8AilqGB.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CHl2ywxc.js">
    <link rel="modulepreload" href="/assets/testing_phase-9-testing-architecture.md.ah52XEOW.lean.js">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Master MCP Server</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/getting-started/overview" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Getting Started</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guides/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Guides</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/api/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/configuration/overview" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Configuration</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/deployment/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Deployment</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/examples/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Examples</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/advanced/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Advanced</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/troubleshooting/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Troubleshooting</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/contributing/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Contributing</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/your-org/master-mcp-server" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/your-org/master-mcp-server" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _testing_phase-9-testing-architecture" data-v-39a288b8><div><h1 id="phase-9-—-comprehensive-testing-architecture" tabindex="-1">Phase 9 — Comprehensive Testing Architecture <a class="header-anchor" href="#phase-9-—-comprehensive-testing-architecture" aria-label="Permalink to &quot;Phase 9 — Comprehensive Testing Architecture&quot;">​</a></h1><p>This document specifies the end-to-end testing architecture for the Master MCP Server across Node.js and Cloudflare Workers. It is tailored to this codebase (TypeScript, ESM, strict mode) and builds on Phases 1–8 (auth, module loading, routing, config, OAuth, utils).</p><h2 id="goals" tabindex="-1">Goals <a class="header-anchor" href="#goals" aria-label="Permalink to &quot;Goals&quot;">​</a></h2><ul><li>Cross-platform: Node 18+ and Cloudflare Workers.</li><li>ESM + TypeScript strict compatibility.</li><li>Leverage existing utilities (logging, validation, monitoring).</li><li>Clear test layering: unit, integration, E2E, plus security and performance.</li><li>Deterministic, isolated, and parallel-friendly test runs.</li><li>CI/CD automation with quality gates and coverage thresholds.</li></ul><hr><h2 id="framework-selection" tabindex="-1">Framework Selection <a class="header-anchor" href="#framework-selection" aria-label="Permalink to &quot;Framework Selection&quot;">​</a></h2><ul><li><p>Unit/Integration (Node): Vitest</p><ul><li>Fast, ESM-native, TS-friendly. Built-in mock timers and coverage via V8.</li><li>Supertest for Express-based HTTP integration of Node runtime (<code>src/index.ts</code>).</li><li>Undici MockAgent (optional) for fetch interception on Node 18, when not spinning stub servers.</li></ul></li><li><p>Unit/Integration (Workers): Vitest + Miniflare 3</p><ul><li><code>miniflare</code> test environment for <code>Request</code>/<code>Response</code> compatibility.</li><li>Target <code>OAuthFlowController.handleRequest</code> and any worker entrypoints (<code>src/runtime/worker.ts</code>).</li></ul></li><li><p>E2E (HTTP-level): Vitest test suite using real HTTP listeners</p><ul><li>Node: start Express via <code>createServer(true)</code> and use Supertest/HTTP.</li><li>Workers: run Miniflare instance or <code>wrangler dev</code> in CI as needed.</li></ul></li><li><p>Performance: Artillery</p><ul><li>Simple YAML scenarios to stress authentication and routing endpoints.</li><li>Separate CI job; can be run locally against dev servers.</li></ul></li><li><p>Security: Vitest + fast-check (property-based) + static assertions</p><ul><li>Fuzz inputs for token parsing, state/PKCE validation, and router input validation.</li><li>Optional OWASP ZAP baseline in CI (nightly) if desired.</li></ul></li></ul><hr><h2 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to &quot;Directory Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>tests/</span></span>
<span class="line"><span>  unit/</span></span>
<span class="line"><span>    routing/              # circuit-breaker, retry, load-balancer</span></span>
<span class="line"><span>    modules/              # aggregator, router (with fetch mocked)</span></span>
<span class="line"><span>    oauth/                # pkce/state/validator</span></span>
<span class="line"><span>    utils/                # logger, validation helpers</span></span>
<span class="line"><span>  integration/</span></span>
<span class="line"><span>    node/                 # express endpoints, config manager wiring</span></span>
<span class="line"><span>    workers/              # flow-controller.handleRequest via Miniflare</span></span>
<span class="line"><span>    oauth/                # callback flow with mock OIDC provider</span></span>
<span class="line"><span>  e2e/</span></span>
<span class="line"><span>    node/                 # start full HTTP server and hit /mcp/*, /oauth/*</span></span>
<span class="line"><span>    workers/              # worker entrypoint end-to-end</span></span>
<span class="line"><span>  mocks/</span></span>
<span class="line"><span>    oauth/                # mock OIDC provider (Node + Worker variants)</span></span>
<span class="line"><span>    mcp/                  # fake MCP backends (capabilities/tools/resources)</span></span>
<span class="line"><span>    http/                 # undici MockAgent helpers (Node)</span></span>
<span class="line"><span>  factories/</span></span>
<span class="line"><span>    configFactory.ts      # MasterConfig, ServerConfig builders</span></span>
<span class="line"><span>    oauthFactory.ts       # tokens/states/JWKS</span></span>
<span class="line"><span>    mcpFactory.ts         # tool/resource definitions</span></span>
<span class="line"><span>  fixtures/</span></span>
<span class="line"><span>    capabilities.json</span></span>
<span class="line"><span>    tools.json</span></span>
<span class="line"><span>    resources.json</span></span>
<span class="line"><span>  perf/</span></span>
<span class="line"><span>    artillery/</span></span>
<span class="line"><span>      auth-routing.yaml   # load scenarios for auth + routing</span></span>
<span class="line"><span>  security/</span></span>
<span class="line"><span>    oauth.spec.ts         # PKCE/state/nonce fuzz tests (fast-check)</span></span>
<span class="line"><span>  _setup/</span></span>
<span class="line"><span>    vitest.setup.ts       # global hooks, silent logs, fake timers config</span></span>
<span class="line"><span>    miniflare.setup.ts    # worker env config for tests</span></span>
<span class="line"><span>  _utils/</span></span>
<span class="line"><span>    test-server.ts        # ephemeral HTTP servers</span></span>
<span class="line"><span>    mock-fetch.ts         # Node fetch interception (Undici)</span></span>
<span class="line"><span>    log-capture.ts        # capture + assert logs</span></span></code></pre></div><p>Notes:</p><ul><li>The unit layer uses pure module-level tests with fetch mocked or local HTTP stubs.</li><li>Integration tests are black-box at module boundaries (e.g., ProtocolHandler + RequestRouter + mocks).</li><li>E2E spins the real Node server and/or Miniflare worker with realistic mocks for upstream MCP servers and OIDC.</li></ul><hr><h2 id="test-environment-management" tabindex="-1">Test Environment Management <a class="header-anchor" href="#test-environment-management" aria-label="Permalink to &quot;Test Environment Management&quot;">​</a></h2><ul><li><p>Node vs Workers selection</p><ul><li>Node-specific Vitest config: <code>vitest.config.ts</code> (environment: node)</li><li>Workers-specific Vitest config: <code>vitest.worker.config.ts</code> (environment: miniflare)</li><li>Test files can explicitly opt into Miniflare with <code>// @vitest-environment miniflare</code>.</li></ul></li><li><p>Isolation and determinism</p><ul><li>Use Vitest’s fake timers for retry/circuit tests.</li><li>Ephemeral HTTP servers: <code>tests/_utils/test-server.ts</code> binds to port 0 and auto-closes in <code>afterEach</code>.</li><li>Log capture: disable or capture logs via <code>Logger.configure({ json: true })</code> for stable assertions.</li></ul></li><li><p>Cross-platform resources</p><ul><li>OAuth flows invoke real HTTP endpoints; a mock OIDC provider runs as an in-process HTTP server in both Node and Miniflare scenarios (Miniflare tests remain in a Node host context, so spinning a Node HTTP stub is acceptable).</li><li>Upstream MCP backends emulated by <code>fake-backend</code> servers exposing <code>/capabilities</code>, <code>/mcp/tools/*</code>, <code>/mcp/resources/*</code>.</li></ul></li></ul><hr><h2 id="mock-and-stub-architecture" tabindex="-1">Mock and Stub Architecture <a class="header-anchor" href="#mock-and-stub-architecture" aria-label="Permalink to &quot;Mock and Stub Architecture&quot;">​</a></h2><h3 id="mcp-protocol-backends" tabindex="-1">MCP Protocol Backends <a class="header-anchor" href="#mcp-protocol-backends" aria-label="Permalink to &quot;MCP Protocol Backends&quot;">​</a></h3><ul><li>Fake backend servers respond with deterministic JSON: <ul><li><code>GET /capabilities</code>: lists tools/resources/prompts</li><li><code>POST /mcp/tools/list</code> and <code>/mcp/resources/list</code>: optional fallbacks</li><li><code>POST /mcp/tools/call</code>: echoes arguments or returns canned results</li><li><code>POST /mcp/resources/read</code>: returns fixture content</li></ul></li><li>Supports Bearer tokens to simulate auth propagation from Master.</li></ul><h3 id="oauth-provider-oidc-mock" tabindex="-1">OAuth Provider (OIDC) Mock <a class="header-anchor" href="#oauth-provider-oidc-mock" aria-label="Permalink to &quot;OAuth Provider (OIDC) Mock&quot;">​</a></h3><ul><li>Node HTTP server (Express or http module) serving: <ul><li><code>/.well-known/openid-configuration</code></li><li><code>/authorize</code>: simulates auth code issuance by redirecting with <code>code</code> + <code>state</code></li><li><code>/token</code>: returns JSON access token, optional refresh, scopes, <code>expires_in</code></li><li><code>/jwks.json</code>: JWKS for completeness if JOSE validation is later added upstream</li></ul></li><li>Uses <code>jose</code> to generate ephemeral key material and produce signed tokens if needed.</li><li>Configurable via factory helpers to tailor provider metadata per test.</li></ul><h3 id="http-mocking-for-node-optional" tabindex="-1">HTTP Mocking for Node (optional) <a class="header-anchor" href="#http-mocking-for-node-optional" aria-label="Permalink to &quot;HTTP Mocking for Node (optional)&quot;">​</a></h3><ul><li><code>undici</code> MockAgent helper when spinning HTTP servers is overkill.</li><li>Route by URL patterns and methods; fallback to network disallowed.</li></ul><hr><h2 id="test-data-management" tabindex="-1">Test Data Management <a class="header-anchor" href="#test-data-management" aria-label="Permalink to &quot;Test Data Management&quot;">​</a></h2><ul><li>Fixtures: JSON payloads for tools/resources/capabilities. Keep small and readable.</li><li>Factories: <ul><li><code>configFactory</code>: produce <code>MasterConfig</code> + <code>ServerConfig</code> with sensible defaults (ports, endpoints, auth strategies).</li><li><code>oauthFactory</code>: generate PKCE/state payloads and basic OAuth token shapes.</li><li><code>mcpFactory</code>: create tool/resource definitions and common requests.</li></ul></li><li>State/Token Stores: <ul><li>In-memory only; reset across tests.</li><li>If a persistent DB is introduced later: <ul><li>Node: use SQLite in-memory or Testcontainers in CI; provide cleanup hooks.</li><li>Workers: use Miniflare KV/D1 bindings with per-test namespaces.</li></ul></li></ul></li></ul><hr><h2 id="performance-testing-strategy-artillery" tabindex="-1">Performance Testing Strategy (Artillery) <a class="header-anchor" href="#performance-testing-strategy-artillery" aria-label="Permalink to &quot;Performance Testing Strategy (Artillery)&quot;">​</a></h2><ul><li>Scenarios: <ul><li>OAuth authorize/token (mock provider) happy-path latency and error rates.</li><li>Routing: <code>POST /mcp/tools/call</code> with mixed success/failure from backends to exercise retry/circuit logic.</li><li>Server lifecycle: parallel discovery calls to <code>/capabilities</code> against multiple backends.</li></ul></li><li>Metrics: <ul><li>p50/p90/p99 latency, RPS, error rates per route.</li><li>Custom logs via <code>Logger.time</code> around critical paths; scrape from structured logs when running locally.</li></ul></li><li>CI: <ul><li>Run on a separate “performance” workflow or on nightly schedules to avoid slowing PRs.</li></ul></li></ul><hr><h2 id="security-testing-architecture" tabindex="-1">Security Testing Architecture <a class="header-anchor" href="#security-testing-architecture" aria-label="Permalink to &quot;Security Testing Architecture&quot;">​</a></h2><ul><li>Property-based testing with <code>fast-check</code> for: <ul><li><code>FlowValidator.validateReturnTo</code>: ensure only safe origins/paths pass.</li><li><code>StateManager</code> and <code>PKCEManager</code>: state integrity, one-time consumption, and PKCE verifier binding.</li><li>Input validation for router requests (e.g., tool/resource names) using <code>utils/validation</code> helpers.</li></ul></li><li>OAuth flow protections: <ul><li>Ensure <code>state</code> is required and consumed exactly once.</li><li>Enforce PKCE method presence, verify rejection on mismatch.</li><li>Token exchange failure handling and error surface is sanitized.</li></ul></li><li>Optional dynamic scans: <ul><li>OWASP ZAP baseline against local server in CI (nightly) to catch obvious misconfigurations.</li></ul></li></ul><hr><h2 id="ci-cd-integration" tabindex="-1">CI/CD Integration <a class="header-anchor" href="#ci-cd-integration" aria-label="Permalink to &quot;CI/CD Integration&quot;">​</a></h2><h3 id="jobs" tabindex="-1">Jobs <a class="header-anchor" href="#jobs" aria-label="Permalink to &quot;Jobs&quot;">​</a></h3><ul><li>Lint + Typecheck: ESLint and <code>tsc -p tsconfig.node.json --noEmit</code>.</li><li>Unit + Integration (Node): Vitest with coverage.</li><li>Unit + Integration (Workers): Vitest (Miniflare) with coverage.</li><li>E2E: start local server; run black-box tests.</li><li>Security: property tests; optional ZAP baseline (nightly).</li><li>Performance: Artillery (nightly or gated by label).</li></ul><h3 id="coverage-and-quality-gates" tabindex="-1">Coverage and Quality Gates <a class="header-anchor" href="#coverage-and-quality-gates" aria-label="Permalink to &quot;Coverage and Quality Gates&quot;">​</a></h3><ul><li>Coverage via Vitest v8 provider; thresholds: <ul><li>Global: <code>branches: 80%</code>, <code>functions: 85%</code>, <code>lines: 85%</code>, <code>statements: 85%</code>.</li><li>Critical modules (routing, oauth): per-file <code>lines: 90%</code> target in follow-up.</li></ul></li><li>Fail PR job if thresholds not met.</li><li>Upload <code>lcov</code> or <code>cobertura</code> to CI artifacts (or Codecov if desired).</li></ul><hr><h2 id="test-utilities-integration-phase-8" tabindex="-1">Test Utilities Integration (Phase 8) <a class="header-anchor" href="#test-utilities-integration-phase-8" aria-label="Permalink to &quot;Test Utilities Integration (Phase 8)&quot;">​</a></h2><ul><li>Logger: <code>Logger.configure({ json: true, level: &#39;error&#39; })</code> in test setup; use <code>log-capture</code> to assert important events.</li><li>Validation: assert guards (<code>assertString</code>, <code>sanitizeObject</code>) across boundary tests; fuzz via fast-check.</li><li>Monitoring: wrap performance-critical test paths with <code>Logger.time</code> and assert upper bounds during perf runs.</li></ul><hr><h2 id="local-and-ci-usage" tabindex="-1">Local and CI Usage <a class="header-anchor" href="#local-and-ci-usage" aria-label="Permalink to &quot;Local and CI Usage&quot;">​</a></h2><ul><li><p>Local:</p><ul><li><code>vitest -c vitest.config.ts</code> for Node suites.</li><li><code>vitest -c vitest.worker.config.ts</code> for Worker suites.</li><li><code>artillery run tests/perf/artillery/auth-routing.yaml</code> for load tests.</li></ul></li><li><p>CI:</p><ul><li>Run jobs in parallel; collect coverage and artifacts.</li><li>Gate merges on lint, typecheck, unit/integration, and coverage.</li></ul></li></ul><hr><h2 id="next-steps-implementation-guide" tabindex="-1">Next Steps (Implementation Guide) <a class="header-anchor" href="#next-steps-implementation-guide" aria-label="Permalink to &quot;Next Steps (Implementation Guide)&quot;">​</a></h2><ol><li>Install dev deps: vitest, @vitest/coverage-v8, supertest, miniflare, artillery, fast-check, @types/supertest.</li><li>Add scripts: <code>test</code>, <code>test:node</code>, <code>test:workers</code>, <code>test:coverage</code>, <code>test:e2e</code>.</li><li>Fill factories and mocks with minimal working endpoints.</li><li>Seed initial critical tests: <ul><li>routing: circuit-breaker/retry/load-balancer</li><li>oauth: state, pkce, callback error handling</li><li>aggregator: discovery + mapping</li><li>protocol: call tool/resource happy path and error path</li></ul></li></ol></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2025-08-15T18:11:40.000Z" data-v-e98dd255></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"advanced_extensibility.md\":\"TrXUn5w5\",\"advanced_index.md\":\"CPcpUlw_\",\"advanced_monitoring.md\":\"DTybdNg-\",\"advanced_performance.md\":\"DKmzK0ia\",\"advanced_security.md\":\"B-oBD7IB\",\"api_index.md\":\"Dl1JB08_\",\"api_readme.md\":\"DZxYTr9n\",\"architecture_phase1-architecture.md\":\"Bwa0Iy7O\",\"architecture_phase10-deployment-architecture.md\":\"C9TzxNCU\",\"architecture_phase11-documentation-architecture.md\":\"BBRumbvu\",\"architecture_phase2-architecture.md\":\"CZ5Rgg-j\",\"architecture_phase3-architecture.md\":\"CTSlHc-B\",\"architecture_phase4-architecture.md\":\"B852juNz\",\"architecture_phase5-architecture.md\":\"DilLkoS7\",\"architecture_phase6-architecture.md\":\"rotMaCW8\",\"architecture_phase7-architecture.md\":\"Bh7Otovi\",\"architecture_phase8-architecture.md\":\"Bg1m_5r_\",\"configuration_environment-variables.md\":\"Ddy3P_Wz\",\"configuration_environment.md\":\"DxcTQ623\",\"configuration_examples.md\":\"Bab8yt7b\",\"configuration_overview.md\":\"DIkVDv7V\",\"configuration_performance.md\":\"DbJdmLrW\",\"configuration_reference.md\":\"27IKWqtk\",\"configuration_security.md\":\"-OOlkzN4\",\"contributing_dev-setup.md\":\"Ceqh4w-R\",\"contributing_guidelines.md\":\"ZEAX2yVh\",\"contributing_index.md\":\"DYq9R6wr\",\"contributing_maintenance.md\":\"k2bR0IaR\",\"deployment_cicd.md\":\"Ci2T0UYC\",\"deployment_cloudflare-workers.md\":\"D2WHsfep\",\"deployment_docker.md\":\"B8bQDQTo\",\"deployment_index.md\":\"ClYeOkpy\",\"deployment_koyeb.md\":\"B_wJhvF7\",\"examples_advanced-routing.md\":\"B3CqhLZ7\",\"examples_basic-node.md\":\"CaDZzGlO\",\"examples_cloudflare-worker.md\":\"DwVSz-c7\",\"examples_index.md\":\"CBF_BLkl\",\"examples_oauth-delegation.md\":\"1hZxoqDl\",\"examples_overview.md\":\"CZN0JbZ7\",\"examples_testing.md\":\"Dek4GpNs\",\"getting-started.md\":\"DG9ndneo\",\"getting-started_concepts.md\":\"D7ON9iGB\",\"getting-started_installation.md\":\"BKnVqAGg\",\"getting-started_overview.md\":\"DvJDFL2N\",\"getting-started_quick-start.md\":\"BAboD7TN\",\"getting-started_quickstart-node.md\":\"GOO4aGas\",\"getting-started_quickstart-workers.md\":\"Cpofh8Mj\",\"guides_authentication.md\":\"BF_rmNNl\",\"guides_client-integration.md\":\"BDL0xQeg\",\"guides_configuration-management.md\":\"B-jwYMbA\",\"guides_configuration.md\":\"Ci3zYDFA\",\"guides_index.md\":\"CIlq2fmx\",\"guides_module-loading.md\":\"BkJvuRnQ\",\"guides_oauth-delegation.md\":\"DEOZ-_G0\",\"guides_request-routing.md\":\"Bdzf0VLg\",\"guides_server-management.md\":\"CdBNYUri\",\"guides_server-sharing.md\":\"CF9KXOB0\",\"guides_testing.md\":\"kYfHqJLu\",\"index.md\":\"H2oHgda-\",\"phase-11_phase-11-research-and-docs-plan.md\":\"DQXXtaI4\",\"readme.md\":\"BO5r5M9u\",\"reports_mcp-compliance-audit.md\":\"DvwrAmVA\",\"research_phase1-analysis.md\":\"CDS2u6i0\",\"research_phase2-analysis.md\":\"YFIYQ8ED\",\"research_phase3-analysis.md\":\"6-kwQIco\",\"research_phase4-analysis.md\":\"Cjwqrpc1\",\"research_phase5-analysis.md\":\"DUgNDwCY\",\"research_phase6-analysis.md\":\"D_7kWjvM\",\"research_phase7-analysis.md\":\"C_JufIBV\",\"research_phase8-analysis.md\":\"VqlhbJUi\",\"review_phase1-self-critique.md\":\"BR9mHtP8\",\"review_phase3-self-critique.md\":\"CNeeAB1q\",\"review_phase4-routing-evaluation.md\":\"Q1RDwX8b\",\"review_phase4-self-critique.md\":\"BahYGljk\",\"review_phase5-self-critique.md\":\"DEWce8pj\",\"review_phase6-evaluation.md\":\"B8OWioNv\",\"review_phase6-self-critique.md\":\"LUVIwJt5\",\"review_phase7-self-critique.md\":\"D5QXsZd1\",\"testing_phase-9-testing-architecture.md\":\"ah52XEOW\",\"troubleshooting_common-issues.md\":\"CScvzWM1\",\"troubleshooting_deployment.md\":\"DUhpqnLE\",\"troubleshooting_errors.md\":\"BSCsEmGc\",\"troubleshooting_index.md\":\"CX5c9Zq5\",\"troubleshooting_oauth.md\":\"Cw60Eka3\",\"troubleshooting_performance.md\":\"DxY6LJcT\",\"troubleshooting_routing.md\":\"BHN-MDhs\",\"troubleshooting_security-best-practices.md\":\"Yiu8E-zt\",\"tutorials_beginner-getting-started.md\":\"BXObgobW\",\"tutorials_cloudflare-workers-tutorial.md\":\"MPHsc0aT\",\"tutorials_load-balancing-and-resilience.md\":\"Dv9r9jyW\",\"tutorials_oauth-delegation-github.md\":\"Nq4glqCe\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Master MCP Server\",\"description\":\"Aggregate and orchestrate multiple MCP servers behind one endpoint\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"siteTitle\":\"Master MCP Server\",\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/your-org/master-mcp-server\"}],\"outline\":[2,6],\"nav\":[{\"text\":\"Getting Started\",\"link\":\"/getting-started/overview\"},{\"text\":\"Guides\",\"link\":\"/guides/index\"},{\"text\":\"API\",\"link\":\"/api/index\"},{\"text\":\"Configuration\",\"link\":\"/configuration/overview\"},{\"text\":\"Deployment\",\"link\":\"/deployment/index\"},{\"text\":\"Examples\",\"link\":\"/examples/index\"},{\"text\":\"Advanced\",\"link\":\"/advanced/index\"},{\"text\":\"Troubleshooting\",\"link\":\"/troubleshooting/index\"},{\"text\":\"Contributing\",\"link\":\"/contributing/index\"}],\"sidebar\":{\"/getting-started/\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Overview\",\"link\":\"/getting-started/overview\"},{\"text\":\"Installation\",\"link\":\"/getting-started/installation\"},{\"text\":\"Quick Start\",\"link\":\"/getting-started/quick-start\"},{\"text\":\"Quickstart (Node)\",\"link\":\"/getting-started/quickstart-node\"},{\"text\":\"Quickstart (Workers)\",\"link\":\"/getting-started/quickstart-workers\"},{\"text\":\"Core Concepts\",\"link\":\"/getting-started/concepts\"}]}],\"/guides/\":[{\"text\":\"User Guides\",\"items\":[{\"text\":\"Authentication\",\"link\":\"/guides/authentication\"},{\"text\":\"OAuth Delegation\",\"link\":\"/guides/oauth-delegation\"},{\"text\":\"Client Integration\",\"link\":\"/guides/client-integration\"},{\"text\":\"Server Sharing\",\"link\":\"/guides/server-sharing\"},{\"text\":\"Module Loading\",\"link\":\"/guides/module-loading\"},{\"text\":\"Request Routing\",\"link\":\"/guides/request-routing\"},{\"text\":\"Configuration\",\"link\":\"/guides/configuration\"},{\"text\":\"Testing Strategy\",\"link\":\"/guides/testing\"}]}],\"/api/\":[{\"text\":\"API Reference\",\"items\":[{\"text\":\"Overview\",\"link\":\"/api/index\"},{\"text\":\"Types\",\"link\":\"/api/reference/modules\"}]}],\"/configuration/\":[{\"text\":\"Configuration\",\"items\":[{\"text\":\"Overview\",\"link\":\"/configuration/overview\"},{\"text\":\"Reference\",\"link\":\"/configuration/reference\"},{\"text\":\"Examples\",\"link\":\"/configuration/examples\"},{\"text\":\"Environment Variables\",\"link\":\"/configuration/environment\"}]}],\"/deployment/\":[{\"text\":\"Deployment\",\"items\":[{\"text\":\"Overview\",\"link\":\"/deployment/index\"},{\"text\":\"Docker\",\"link\":\"/deployment/docker\"},{\"text\":\"Cloudflare Workers\",\"link\":\"/deployment/cloudflare-workers\"},{\"text\":\"Koyeb\",\"link\":\"/deployment/koyeb\"}]}],\"/examples/\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Index\",\"link\":\"/examples/index\"},{\"text\":\"Basic Node Aggregator\",\"link\":\"/examples/basic-node\"},{\"text\":\"Cloudflare Worker\",\"link\":\"/examples/cloudflare-worker\"},{\"text\":\"Advanced Routing\",\"link\":\"/examples/advanced-routing\"},{\"text\":\"OAuth Delegation\",\"link\":\"/examples/oauth-delegation\"},{\"text\":\"Testing Patterns\",\"link\":\"/examples/testing\"}]}],\"/advanced/\":[{\"text\":\"Advanced Topics\",\"items\":[{\"text\":\"Security Hardening\",\"link\":\"/advanced/security\"},{\"text\":\"Performance & Scalability\",\"link\":\"/advanced/performance\"},{\"text\":\"Monitoring & Logging\",\"link\":\"/advanced/monitoring\"},{\"text\":\"Extensibility & Plugins\",\"link\":\"/advanced/extensibility\"}]}],\"/troubleshooting/\":[{\"text\":\"Troubleshooting\",\"items\":[{\"text\":\"Common Issues\",\"link\":\"/troubleshooting/index\"},{\"text\":\"OAuth & Tokens\",\"link\":\"/troubleshooting/oauth\"},{\"text\":\"Routing & Modules\",\"link\":\"/troubleshooting/routing\"},{\"text\":\"Deployment\",\"link\":\"/troubleshooting/deployment\"}]}],\"/contributing/\":[{\"text\":\"Contributing\",\"items\":[{\"text\":\"Overview\",\"link\":\"/contributing/index\"},{\"text\":\"Development Setup\",\"link\":\"/contributing/dev-setup\"},{\"text\":\"Coding & Docs Guidelines\",\"link\":\"/contributing/guidelines\"}]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>