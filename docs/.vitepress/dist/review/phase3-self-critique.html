<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>Phase 3 Self‑Critique — Module Loading System | Master MCP Server</title>
    <meta name="description" content="Aggregate and orchestrate multiple MCP servers behind one endpoint">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.BQrfSMzK.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CHJJO2XB.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.B8AilqGB.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CHl2ywxc.js">
    <link rel="modulepreload" href="/assets/review_phase3-self-critique.md.CNeeAB1q.lean.js">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Master MCP Server</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/getting-started/overview" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Getting Started</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guides/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Guides</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/api/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/configuration/overview" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Configuration</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/deployment/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Deployment</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/examples/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Examples</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/advanced/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Advanced</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/troubleshooting/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Troubleshooting</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/contributing/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Contributing</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/your-org/master-mcp-server" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/your-org/master-mcp-server" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _review_phase3-self-critique" data-v-39a288b8><div><h1 id="phase-3-self‐critique-—-module-loading-system" tabindex="-1">Phase 3 Self‑Critique — Module Loading System <a class="header-anchor" href="#phase-3-self‐critique-—-module-loading-system" aria-label="Permalink to &quot;Phase 3 Self‑Critique — Module Loading System&quot;">​</a></h1><p>Scope: Evaluation of the Phase 3 implementation across ModuleLoader (<code>src/modules/module-loader.ts</code>), CapabilityAggregator (<code>src/modules/capability-aggregator.ts</code>), and RequestRouter (<code>src/modules/request-router.ts</code>) and how they integrate with the surrounding system (notably <code>src/server/master-server.ts</code>, Phase 1/2 types and auth scaffolding, and build configs).</p><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>Phase 3 delivers a clear, ESM-first scaffolding for a multi-source Module Loader, an aggregator that composes tools/resources with conflict avoidance, and a simple HTTP-based router. The architecture largely respects separation of concerns and is conscious of Node vs. Workers compatibility. However, several integration mismatches, incomplete process orchestration, and missing safety controls (timeouts, validation, SSRF hardening) pose risks for Phase 4 routing and beyond. The most acute blocker is a prefixing mismatch between aggregation and routing that will misroute calls when prefixing is disabled or when identifiers include dots.</p><hr><h2 id="architecture-quality" tabindex="-1">Architecture Quality <a class="header-anchor" href="#architecture-quality" aria-label="Permalink to &quot;Architecture Quality&quot;">​</a></h2><ul><li>Module boundaries: Good separation. <ul><li><code>DefaultModuleLoader</code> focuses on discovery, endpoint derivation, and health probes; process spawning is intentionally abstracted as placeholders for future adapters. This keeps the module portable and testable.</li><li><code>CapabilityAggregator</code> owns discovery + name/URI aggregation and reverse mapping.</li><li><code>RequestRouter</code> handles fan-out to backends using pre-aggregated names.</li></ul></li><li>Extensibility: Reasonable but some gaps. <ul><li>Server-type detection is heuristic and embedded in <code>DefaultModuleLoader</code>. A pluggable detector/adapter registry (per source and runtime) would scale better.</li><li>No transport/process adapter interfaces yet (e.g., Stdio/HTTP/WS or ProcessSupervisor), despite being described in Phase 3 research notes. This will be needed when real spawn/remote transports land.</li></ul></li><li>Integration surface: <ul><li><code>MasterServer</code> assembles loader, aggregator, and router cleanly. <code>ProtocolHandler</code> remains a stub (Phase 4 target), which is acceptable.</li></ul></li></ul><h2 id="implementation-robustness" tabindex="-1">Implementation Robustness <a class="header-anchor" href="#implementation-robustness" aria-label="Permalink to &quot;Implementation Robustness&quot;">​</a></h2><ul><li>Health checks: Implemented but fragile. <ul><li>Uses <code>fetch</code> without timeout/abort or jittered retry; can hang under network issues, delaying startup and health reporting.</li><li>Sets <code>status</code> from the first health probe; no liveness/readiness separation or hysteresis.</li></ul></li><li>Endpoint derivation: <ul><li>Prefers <code>config.config.port</code> → <code>http://&lt;defaultHostname&gt;:&lt;port&gt;</code>; else uses <code>config.url</code> only if http(s). Good default, but does not honor any explicit <code>base_url</code> in hosting config nor Docker-specific mappings.</li></ul></li><li>Multi-source loaders: Implemented as logging + stubs. <ul><li><code>git</code>/<code>npm</code>/<code>pypi</code>/<code>docker</code>/<code>local</code> all funnel to <code>startRuntime</code> but actual spawn management is deferred. Acceptable for Phase 3, but Phase 4 will stress this.</li></ul></li><li>Aggregation and discovery: <ul><li>Tries <code>GET /capabilities</code> then falls back to <code>POST /mcp/tools/list</code> + <code>POST /mcp/resources/list</code>. Coerces shapes defensively. Good resilience.</li><li>Maintains reverse maps (<code>toolMap</code>, <code>resourceMap</code>) for routing; however the router does not use these maps (see Integration section).</li></ul></li><li>Router behavior: <ul><li>Splits tool/resource identifiers on &#39;.&#39; (<code>serverId.toolName</code>), then posts to <code>POST /mcp/tools/call</code> or <code>POST /mcp/resources/read</code> on the target server.</li><li>Error shapes differ across routes (call tool returns <code>{ isError: true }</code>, read resource returns text). Should be consistent.</li></ul></li><li>Validation: <ul><li>No schema validation for tool arguments against <code>inputSchema</code>; no URI validation/sanitization.</li></ul></li></ul><h2 id="cross‐platform-compatibility" tabindex="-1">Cross‑Platform Compatibility <a class="header-anchor" href="#cross‐platform-compatibility" aria-label="Permalink to &quot;Cross‑Platform Compatibility&quot;">​</a></h2><ul><li>ESM + TS config: Aligned with NodeNext/Bundler, <code>.js</code> import suffixes, and Workers lib target. Good.</li><li>Platform abstractions: <ul><li>Loader avoids Node APIs; <code>Logger</code> uses <code>globalThis?.process?.env</code> guarded by optional chaining; OK for Workers.</li><li>Workers tsconfig excludes Node-specific files (crypto, token store). Good.</li></ul></li><li>Remaining concerns: <ul><li>No explicit fetch polyfill paths; relies on Node 18+ global <code>fetch</code> (documented via engines field). <code>node-fetch</code> is declared but not used; this could be removed or justified.</li></ul></li></ul><h2 id="security-considerations" tabindex="-1">Security Considerations <a class="header-anchor" href="#security-considerations" aria-label="Permalink to &quot;Security Considerations&quot;">​</a></h2><ul><li>Input validation: Missing. <ul><li>Tool args are forwarded verbatim; no validation against advertised <code>inputSchema</code>.</li><li>Resource URIs are accepted and forwarded without normalization or allowlisting.</li></ul></li><li>Endpoint safety: <ul><li><code>ServerConfig.url</code> can point to arbitrary hosts; without allowlists/subnet blocks, the master could be used for SSRF.</li><li>No scheme restriction beyond <code>http(s)</code> check; consider rejecting non-HTTP schemes explicitly, normalizing URLs, and enforcing allowed hostnames/IPs.</li></ul></li><li>Auth handling: <ul><li>Router leverages an injected <code>getAuthHeaders</code>; good separation. Ensure tokens are never logged (current Logger usage avoids logging tokens but confirm upstream error logging policies).</li></ul></li><li>Process isolation: Not implemented yet (placeholders). Node/Docker supervisors and sandboxing are deferred; highlight as mandatory before production.</li></ul><h2 id="performance" tabindex="-1">Performance <a class="header-anchor" href="#performance" aria-label="Permalink to &quot;Performance&quot;">​</a></h2><ul><li>Startup/discovery: <ul><li><code>Promise.all</code> on discovery is good, but no throttling/backoff; can cause a thundering herd on many servers. Consider concurrency limits with jitter.</li><li>No capability caching/ETag/If-None-Match; repeated discovery will refetch everything.</li></ul></li><li>Health checks: <ul><li>No TTL or circuit breaker; repeated failures may spam logs.</li></ul></li><li>Router: <ul><li>Stateless pass-through; minimal overhead. No request coalescing or retry.</li></ul></li></ul><h2 id="maintainability" tabindex="-1">Maintainability <a class="header-anchor" href="#maintainability" aria-label="Permalink to &quot;Maintainability&quot;">​</a></h2><ul><li>Code clarity: Clean, typed, and readable. Good use of small helpers (ensureTrailingSlash, aggregateName).</li><li>Documentation: Inline comments explain intent; some configs (prefix strategy, endpoint assumptions) deserve a README section.</li><li>Testing readiness: Components are unit-testable via fetch mocks. No tests exist yet; high-value tests are straightforward (see Recommendations).</li></ul><h2 id="integration" tabindex="-1">Integration <a class="header-anchor" href="#integration" aria-label="Permalink to &quot;Integration&quot;">​</a></h2><ul><li>Aggregator ↔ Router mismatch (blocker): <ul><li>Aggregator supports <code>prefixStrategy: &#39;serverId&#39; | &#39;none&#39;</code> and maintains reverse maps.</li><li>Router ignores the reverse maps and hard-depends on dot prefixing (<code>serverId.tool</code> and <code>serverId.resource</code> via <code>split(&#39;.&#39;)</code>).</li><li>Consequences: <ul><li>If <code>prefixStrategy</code> is <code>&#39;none&#39;</code>, router cannot resolve targets.</li><li>Identifiers containing &#39;.&#39; (common for URIs and possible for tool names) will be misparsed.</li></ul></li><li>Fix: Router should resolve via Aggregator maps first (preferred), then optional delimiter parsing when maps miss.</li></ul></li><li>Phase 1/2 wiring: <ul><li><code>MasterServer</code> composes loader/aggregator/router and exposes simple start/health/discovery helpers. <code>ProtocolHandler</code> remains <code>NotImplemented</code>, which is expected pre‑Phase 4.</li></ul></li></ul><h2 id="standards-compliance" tabindex="-1">Standards Compliance <a class="header-anchor" href="#standards-compliance" aria-label="Permalink to &quot;Standards Compliance&quot;">​</a></h2><ul><li>TypeScript best practices: Strong types and strict compiler options are used. Good.</li><li>ESM compatibility: <code>.js</code> extensions and ModuleResolution settings are consistent. Good.</li><li>MCP SDK alignment: Current types are minimal stubs; the HTTP endpoints (<code>/mcp/*</code>) are a pragmatic stand‑in. For Phase 4, switching to SDK transports (JSON-RPC) will require an adapter layer.</li></ul><h2 id="future-phase-readiness" tabindex="-1">Future Phase Readiness <a class="header-anchor" href="#future-phase-readiness" aria-label="Permalink to &quot;Future Phase Readiness&quot;">​</a></h2><ul><li>Phase 4 (Request Routing): <ul><li>Pros: Router and aggregator exist; auth header injection path is defined.</li><li>Gaps: ProtocolHandler to MCP SDK bridge is missing; aggregator↔router mapping mismatch must be resolved; no streaming/subscriptions; no tool arg validation.</li></ul></li><li>Later phases (process management, resilience): <ul><li>Need ProcessSupervisor, spawn adapters (Node/Python/Docker), transport adapters (stdio/ws/http), and retry/circuit breaker patterns.</li></ul></li></ul><h2 id="gap-analysis-technical-debt" tabindex="-1">Gap Analysis / Technical Debt <a class="header-anchor" href="#gap-analysis-technical-debt" aria-label="Permalink to &quot;Gap Analysis / Technical Debt&quot;">​</a></h2><ul><li>Process orchestration: Placeholders only; no spawn, logs, backoff, or cleanup.</li><li>Routing identifiers: Delimiter choice (&#39;.&#39;) diverges from research docs (&#39;😂. No escaping/quoting strategy. Reverse mapping not used by router.</li><li>Network robustness: Missing timeouts, retries, and concurrency control.</li><li>Security: No schema validation, SSRF protections, or URI allowlisting.</li><li>Caching: No capability/health TTLs or memoization.</li><li>Error shape: Inconsistent error payloads between routes; lack of typed error result.</li><li>Tests: None yet; high-value areas are untested.</li></ul><hr><h2 id="prioritized-recommendations" tabindex="-1">Prioritized Recommendations <a class="header-anchor" href="#prioritized-recommendations" aria-label="Permalink to &quot;Prioritized Recommendations&quot;">​</a></h2><ol><li>Fix routing identifier resolution (Blocker)</li></ol><ul><li>Use <code>CapabilityAggregator.getMappingForTool()</code> and <code>.getMappingForResource()</code> to resolve <code>serverId</code> + original name/URI instead of splitting on &#39;.&#39;.</li><li>Keep delimiter purely presentational. If parsing is needed, adopt a safe format (e.g., <code>serverId::name</code>) and document it; avoid <code>.</code> for URIs.</li></ul><ol start="2"><li>Add network timeouts and retries (High)</li></ol><ul><li>Wrap all <code>fetch</code> calls with <code>AbortController</code> timeouts (e.g., 3–5s default) + limited retry with backoff for idempotent reads (<code>health</code>, <code>capabilities</code>, listing).</li><li>Record last error/latency for diagnostics; avoid unlimited hangs.</li></ul><ol start="3"><li>Introduce endpoint hardening (High)</li></ol><ul><li>Validate <code>ServerConfig.url</code> and derived endpoints: enforce http/https only, normalize, and block private ranges or require explicit allowlist.</li><li>Add an optional per‑server allowlist/denylist in config.</li></ul><ol start="4"><li>Standardize error responses (Medium)</li></ol><ul><li>Align <code>routeCallTool</code>, <code>routeReadResource</code> to return a common error envelope <code>{ isError: true, content: { code?, message } }</code>.</li><li>Ensure no sensitive details leak; log minimal context.</li></ul><ol start="5"><li>Implement argument and URI validation (Medium)</li></ol><ul><li>If <code>ToolDefinition.inputSchema</code> exists, validate <code>req.arguments</code> before forwarding.</li><li>Normalize/validate resource URIs (scheme allowlist, encoding). Reject suspicious inputs.</li></ul><ol start="6"><li>Add capability caching and health TTL (Medium)</li></ol><ul><li>Cache discovery results with a short TTL (e.g., 30–120s) and expose a “refresh” method.</li><li>Debounce repeated health checks; optionally track moving average status.</li></ul><ol start="7"><li>Prepare adapter interfaces (Medium)</li></ol><ul><li>Define <code>TransportAdapter</code> and <code>ProcessSupervisor</code> interfaces and integrate them into <code>DefaultModuleLoader</code> scaffolding without implementing platform specifics yet.</li><li>Move runtime detection into a pluggable registry.</li></ul><ol start="8"><li>Concurrency/throttling (Low)</li></ol><ul><li>Limit concurrent discovery/health probes; add jitter to reduce herd effects.</li></ul><ol start="9"><li>Clean up deps and docs (Low)</li></ol><ul><li>Drop <code>node-fetch</code> if unused; document prefix strategy and routing semantics in README.</li></ul><hr><h2 id="risk-assessment-for-phase-4" tabindex="-1">Risk Assessment for Phase 4 <a class="header-anchor" href="#risk-assessment-for-phase-4" aria-label="Permalink to &quot;Risk Assessment for Phase 4&quot;">​</a></h2><ul><li>Routing correctness (High): Without fixing aggregator↔router mapping and delimiter semantics, Phase 4 MCP routing will mis-target tools/resources and break when prefixing is disabled.</li><li>Security exposure (High): Lack of endpoint allowlisting and input validation risks SSRF and unsafe backend invocation.</li><li>Operational reliability (Medium): No timeouts/backoff can cause hangs and cascading failures during discovery/health.</li><li>Platform gap (Medium): Missing transport/process adapters will limit real deployments (stdio/ws, local spawn) until added.</li><li>API divergence (Low/Medium): HTTP <code>/mcp/*</code> endpoints differ from MCP JSON-RPC; an adapter will be needed but is tractable.</li></ul><p>Mitigations: Implement items 1–3 above before advancing; 4–5 are advisable in parallel; 6–9 can land incrementally.</p><hr><h2 id="overall-quality-score-6-5-10" tabindex="-1">Overall Quality Score: 6.5 / 10 <a class="header-anchor" href="#overall-quality-score-6-5-10" aria-label="Permalink to &quot;Overall Quality Score: 6.5 / 10&quot;">​</a></h2><ul><li>Strengths: Clear modularization, ESM-first build, cross-platform-conscious coding, sensible discovery fallbacks, and clean integration in <code>MasterServer</code>.</li><li>Weaknesses: Critical routing mismatch, lack of network hardening and validation, and unimplemented process orchestration.</li><li>Justification: Solid foundation with good structure, but several correctness and security gaps must be addressed to confidently proceed to Phase 4 routing.</li></ul><hr><h2 id="appendix-—-concrete-change-sketches" tabindex="-1">Appendix — Concrete Change Sketches <a class="header-anchor" href="#appendix-—-concrete-change-sketches" aria-label="Permalink to &quot;Appendix — Concrete Change Sketches&quot;">​</a></h2><ul><li>Router using reverse maps (illustrative only):</li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// in src/modules/request-router.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> toolMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.aggregator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMappingForTool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.name);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (toolMap) { serverId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> toolMap.serverId; toolName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> toolMap.originalName; }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// else fallback to delimiter parsing if you still wish to support it</span></span></code></pre></div><ul><li>Fetch with timeout helper:</li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchWithTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RequestInit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">timeoutMs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), init.timeoutMs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(input, { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">init, signal: controller.signal }); }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id); }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>Endpoint validation idea:</li></ul><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isAllowedUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">urlStr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">allowedHosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> u</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(urlStr);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u.protocol)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> allowedHosts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u.hostname);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2025-08-15T18:11:40.000Z" data-v-e98dd255></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"advanced_extensibility.md\":\"TrXUn5w5\",\"advanced_index.md\":\"CPcpUlw_\",\"advanced_monitoring.md\":\"DTybdNg-\",\"advanced_performance.md\":\"DKmzK0ia\",\"advanced_security.md\":\"B-oBD7IB\",\"api_index.md\":\"Dl1JB08_\",\"api_readme.md\":\"DZxYTr9n\",\"architecture_phase1-architecture.md\":\"Bwa0Iy7O\",\"architecture_phase10-deployment-architecture.md\":\"C9TzxNCU\",\"architecture_phase11-documentation-architecture.md\":\"BBRumbvu\",\"architecture_phase2-architecture.md\":\"CZ5Rgg-j\",\"architecture_phase3-architecture.md\":\"CTSlHc-B\",\"architecture_phase4-architecture.md\":\"B852juNz\",\"architecture_phase5-architecture.md\":\"DilLkoS7\",\"architecture_phase6-architecture.md\":\"rotMaCW8\",\"architecture_phase7-architecture.md\":\"Bh7Otovi\",\"architecture_phase8-architecture.md\":\"Bg1m_5r_\",\"configuration_environment-variables.md\":\"Ddy3P_Wz\",\"configuration_environment.md\":\"DxcTQ623\",\"configuration_examples.md\":\"Bab8yt7b\",\"configuration_overview.md\":\"DIkVDv7V\",\"configuration_performance.md\":\"DbJdmLrW\",\"configuration_reference.md\":\"27IKWqtk\",\"configuration_security.md\":\"-OOlkzN4\",\"contributing_dev-setup.md\":\"Ceqh4w-R\",\"contributing_guidelines.md\":\"ZEAX2yVh\",\"contributing_index.md\":\"DYq9R6wr\",\"contributing_maintenance.md\":\"k2bR0IaR\",\"deployment_cicd.md\":\"Ci2T0UYC\",\"deployment_cloudflare-workers.md\":\"D2WHsfep\",\"deployment_docker.md\":\"B8bQDQTo\",\"deployment_index.md\":\"ClYeOkpy\",\"deployment_koyeb.md\":\"B_wJhvF7\",\"examples_advanced-routing.md\":\"B3CqhLZ7\",\"examples_basic-node.md\":\"CaDZzGlO\",\"examples_cloudflare-worker.md\":\"DwVSz-c7\",\"examples_index.md\":\"CBF_BLkl\",\"examples_oauth-delegation.md\":\"1hZxoqDl\",\"examples_overview.md\":\"CZN0JbZ7\",\"examples_testing.md\":\"Dek4GpNs\",\"getting-started.md\":\"DG9ndneo\",\"getting-started_concepts.md\":\"D7ON9iGB\",\"getting-started_installation.md\":\"BKnVqAGg\",\"getting-started_overview.md\":\"DvJDFL2N\",\"getting-started_quick-start.md\":\"BAboD7TN\",\"getting-started_quickstart-node.md\":\"GOO4aGas\",\"getting-started_quickstart-workers.md\":\"Cpofh8Mj\",\"guides_authentication.md\":\"BF_rmNNl\",\"guides_client-integration.md\":\"BDL0xQeg\",\"guides_configuration-management.md\":\"B-jwYMbA\",\"guides_configuration.md\":\"Ci3zYDFA\",\"guides_index.md\":\"CIlq2fmx\",\"guides_module-loading.md\":\"BkJvuRnQ\",\"guides_oauth-delegation.md\":\"DEOZ-_G0\",\"guides_request-routing.md\":\"Bdzf0VLg\",\"guides_server-management.md\":\"CdBNYUri\",\"guides_server-sharing.md\":\"CF9KXOB0\",\"guides_testing.md\":\"kYfHqJLu\",\"index.md\":\"H2oHgda-\",\"phase-11_phase-11-research-and-docs-plan.md\":\"DQXXtaI4\",\"readme.md\":\"BO5r5M9u\",\"reports_mcp-compliance-audit.md\":\"DvwrAmVA\",\"research_phase1-analysis.md\":\"CDS2u6i0\",\"research_phase2-analysis.md\":\"YFIYQ8ED\",\"research_phase3-analysis.md\":\"6-kwQIco\",\"research_phase4-analysis.md\":\"Cjwqrpc1\",\"research_phase5-analysis.md\":\"DUgNDwCY\",\"research_phase6-analysis.md\":\"D_7kWjvM\",\"research_phase7-analysis.md\":\"C_JufIBV\",\"research_phase8-analysis.md\":\"VqlhbJUi\",\"review_phase1-self-critique.md\":\"BR9mHtP8\",\"review_phase3-self-critique.md\":\"CNeeAB1q\",\"review_phase4-routing-evaluation.md\":\"Q1RDwX8b\",\"review_phase4-self-critique.md\":\"BahYGljk\",\"review_phase5-self-critique.md\":\"DEWce8pj\",\"review_phase6-evaluation.md\":\"B8OWioNv\",\"review_phase6-self-critique.md\":\"LUVIwJt5\",\"review_phase7-self-critique.md\":\"D5QXsZd1\",\"testing_phase-9-testing-architecture.md\":\"ah52XEOW\",\"troubleshooting_common-issues.md\":\"CScvzWM1\",\"troubleshooting_deployment.md\":\"DUhpqnLE\",\"troubleshooting_errors.md\":\"BSCsEmGc\",\"troubleshooting_index.md\":\"CX5c9Zq5\",\"troubleshooting_oauth.md\":\"Cw60Eka3\",\"troubleshooting_performance.md\":\"DxY6LJcT\",\"troubleshooting_routing.md\":\"BHN-MDhs\",\"troubleshooting_security-best-practices.md\":\"Yiu8E-zt\",\"tutorials_beginner-getting-started.md\":\"BXObgobW\",\"tutorials_cloudflare-workers-tutorial.md\":\"MPHsc0aT\",\"tutorials_load-balancing-and-resilience.md\":\"Dv9r9jyW\",\"tutorials_oauth-delegation-github.md\":\"Nq4glqCe\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Master MCP Server\",\"description\":\"Aggregate and orchestrate multiple MCP servers behind one endpoint\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"siteTitle\":\"Master MCP Server\",\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/your-org/master-mcp-server\"}],\"outline\":[2,6],\"nav\":[{\"text\":\"Getting Started\",\"link\":\"/getting-started/overview\"},{\"text\":\"Guides\",\"link\":\"/guides/index\"},{\"text\":\"API\",\"link\":\"/api/index\"},{\"text\":\"Configuration\",\"link\":\"/configuration/overview\"},{\"text\":\"Deployment\",\"link\":\"/deployment/index\"},{\"text\":\"Examples\",\"link\":\"/examples/index\"},{\"text\":\"Advanced\",\"link\":\"/advanced/index\"},{\"text\":\"Troubleshooting\",\"link\":\"/troubleshooting/index\"},{\"text\":\"Contributing\",\"link\":\"/contributing/index\"}],\"sidebar\":{\"/getting-started/\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Overview\",\"link\":\"/getting-started/overview\"},{\"text\":\"Installation\",\"link\":\"/getting-started/installation\"},{\"text\":\"Quick Start\",\"link\":\"/getting-started/quick-start\"},{\"text\":\"Quickstart (Node)\",\"link\":\"/getting-started/quickstart-node\"},{\"text\":\"Quickstart (Workers)\",\"link\":\"/getting-started/quickstart-workers\"},{\"text\":\"Core Concepts\",\"link\":\"/getting-started/concepts\"}]}],\"/guides/\":[{\"text\":\"User Guides\",\"items\":[{\"text\":\"Authentication\",\"link\":\"/guides/authentication\"},{\"text\":\"OAuth Delegation\",\"link\":\"/guides/oauth-delegation\"},{\"text\":\"Client Integration\",\"link\":\"/guides/client-integration\"},{\"text\":\"Server Sharing\",\"link\":\"/guides/server-sharing\"},{\"text\":\"Module Loading\",\"link\":\"/guides/module-loading\"},{\"text\":\"Request Routing\",\"link\":\"/guides/request-routing\"},{\"text\":\"Configuration\",\"link\":\"/guides/configuration\"},{\"text\":\"Testing Strategy\",\"link\":\"/guides/testing\"}]}],\"/api/\":[{\"text\":\"API Reference\",\"items\":[{\"text\":\"Overview\",\"link\":\"/api/index\"},{\"text\":\"Types\",\"link\":\"/api/reference/modules\"}]}],\"/configuration/\":[{\"text\":\"Configuration\",\"items\":[{\"text\":\"Overview\",\"link\":\"/configuration/overview\"},{\"text\":\"Reference\",\"link\":\"/configuration/reference\"},{\"text\":\"Examples\",\"link\":\"/configuration/examples\"},{\"text\":\"Environment Variables\",\"link\":\"/configuration/environment\"}]}],\"/deployment/\":[{\"text\":\"Deployment\",\"items\":[{\"text\":\"Overview\",\"link\":\"/deployment/index\"},{\"text\":\"Docker\",\"link\":\"/deployment/docker\"},{\"text\":\"Cloudflare Workers\",\"link\":\"/deployment/cloudflare-workers\"},{\"text\":\"Koyeb\",\"link\":\"/deployment/koyeb\"}]}],\"/examples/\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Index\",\"link\":\"/examples/index\"},{\"text\":\"Basic Node Aggregator\",\"link\":\"/examples/basic-node\"},{\"text\":\"Cloudflare Worker\",\"link\":\"/examples/cloudflare-worker\"},{\"text\":\"Advanced Routing\",\"link\":\"/examples/advanced-routing\"},{\"text\":\"OAuth Delegation\",\"link\":\"/examples/oauth-delegation\"},{\"text\":\"Testing Patterns\",\"link\":\"/examples/testing\"}]}],\"/advanced/\":[{\"text\":\"Advanced Topics\",\"items\":[{\"text\":\"Security Hardening\",\"link\":\"/advanced/security\"},{\"text\":\"Performance & Scalability\",\"link\":\"/advanced/performance\"},{\"text\":\"Monitoring & Logging\",\"link\":\"/advanced/monitoring\"},{\"text\":\"Extensibility & Plugins\",\"link\":\"/advanced/extensibility\"}]}],\"/troubleshooting/\":[{\"text\":\"Troubleshooting\",\"items\":[{\"text\":\"Common Issues\",\"link\":\"/troubleshooting/index\"},{\"text\":\"OAuth & Tokens\",\"link\":\"/troubleshooting/oauth\"},{\"text\":\"Routing & Modules\",\"link\":\"/troubleshooting/routing\"},{\"text\":\"Deployment\",\"link\":\"/troubleshooting/deployment\"}]}],\"/contributing/\":[{\"text\":\"Contributing\",\"items\":[{\"text\":\"Overview\",\"link\":\"/contributing/index\"},{\"text\":\"Development Setup\",\"link\":\"/contributing/dev-setup\"},{\"text\":\"Coding & Docs Guidelines\",\"link\":\"/contributing/guidelines\"}]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>