<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>Master MCP Server — Phase 3 Module Loading Architecture | Master MCP Server</title>
    <meta name="description" content="Aggregate and orchestrate multiple MCP servers behind one endpoint">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.BQrfSMzK.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CHJJO2XB.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.B8AilqGB.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CHl2ywxc.js">
    <link rel="modulepreload" href="/assets/architecture_phase3-architecture.md.CTSlHc-B.lean.js">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Master MCP Server</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/getting-started/overview" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Getting Started</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guides/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Guides</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/api/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/configuration/overview" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Configuration</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/deployment/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Deployment</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/examples/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Examples</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/advanced/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Advanced</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/troubleshooting/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Troubleshooting</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/contributing/index" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Contributing</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/your-org/master-mcp-server" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/your-org/master-mcp-server" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _architecture_phase3-architecture" data-v-39a288b8><div><h1 id="master-mcp-server-—-phase-3-module-loading-architecture" tabindex="-1">Master MCP Server — Phase 3 Module Loading Architecture <a class="header-anchor" href="#master-mcp-server-—-phase-3-module-loading-architecture" aria-label="Permalink to &quot;Master MCP Server — Phase 3 Module Loading Architecture&quot;">​</a></h1><p>This document proposes the Phase 3 architecture for the module loading and runtime orchestration layer of the Master MCP Server. It builds on the authentication foundation from Phase 2 and the research findings for Phase 3 to support heterogeneous MCP servers from multiple sources with robust lifecycle management, capability aggregation, and health monitoring.</p><h2 id="scope-and-goals" tabindex="-1">Scope and Goals <a class="header-anchor" href="#scope-and-goals" aria-label="Permalink to &quot;Scope and Goals&quot;">​</a></h2><ul><li>Multi-source module loading (git, npm, PyPI, Docker, local; plus remote endpoints/Workers)</li><li>Process management abstraction for local processes (Node.js, Python) and remote runtimes (Workers/HTTP/WebSocket)</li><li>Capability discovery and aggregation across multiple servers with namespacing and conflict resolution</li><li>Server lifecycle management (install, start, stop, restart) with health monitoring and failure recovery</li><li>Cross-platform compatibility (macOS, Linux, Windows) and testable abstractions</li><li>Server type detection and runtime selection</li><li>Repository management and dependency handling with caching and isolation</li><li>Integration with Phase 2 authentication for source access, registry pulls, and server runtime secrets</li></ul><h2 id="guiding-principles" tabindex="-1">Guiding Principles <a class="header-anchor" href="#guiding-principles" aria-label="Permalink to &quot;Guiding Principles&quot;">​</a></h2><ul><li>Explicit interfaces at every boundary for testability and platform independence</li><li>Deterministic, idempotent installs with content-addressed caching</li><li>Principle of least privilege for credentials and process permissions</li><li>Observability-first: structured logs, health metrics, and lifecycle events</li><li>Fail fast on misconfiguration; auto-recover on transient failures with bounded backoff</li></ul><hr><h2 id="key-abstractions-and-interfaces" tabindex="-1">Key Abstractions and Interfaces <a class="header-anchor" href="#key-abstractions-and-interfaces" aria-label="Permalink to &quot;Key Abstractions and Interfaces&quot;">​</a></h2><ul><li><code>ModuleLoader</code>: Orchestrates end-to-end load: resolve → fetch → install → detect → run → discover → register</li><li><code>SourceResolverRegistry</code> + <code>ISourceResolver</code>: Resolves and fetches modules from different sources</li><li><code>RepoCache</code> and <code>ArtifactStore</code>: Content-addressed cache for source artifacts and built assets</li><li><code>DependencyInstaller</code>: Per-language dependency/runtime setup with isolation</li><li><code>ServerTypeDetector</code>: Heuristics/manifests to select runtime (Node/Python/Docker/Remote)</li><li><code>RuntimeOrchestrator</code>: Selects and manages an appropriate <code>IRuntime</code> via <code>IProcessManager</code> or <code>IRemoteEndpoint</code></li><li><code>MCPTransport</code>: Transport abstraction (stdio, TCP, WebSocket) for MCP protocol</li><li><code>CapabilityAggregator</code> + <code>CapabilityRegistry</code>: Aggregated view over tools/resources/prompts, with namespacing</li><li><code>ServerSupervisor</code>: Lifecycle, health monitoring, and failure recovery for each server</li><li><code>AuthProvider</code>: Phase 2 integration for credentials (SCM/registries/runtime secrets)</li><li><code>PlatformAdapter</code>: Cross-platform process, paths, signals, and environment handling</li><li><code>ServerRegistry</code>: Catalog of installed/running servers and their capabilities</li></ul><hr><h2 id="class-diagram" tabindex="-1">Class Diagram <a class="header-anchor" href="#class-diagram" aria-label="Permalink to &quot;Class Diagram&quot;">​</a></h2><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">classDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  direction LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class ModuleLoader {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +load(spec: ModuleSpec) ServerRecord</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    -resolveSource(spec): ResolvedSource</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    -installDependencies(resolved): InstallResult</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    -detectServerType(install): ServerType</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    -provisionRuntime(type, install): RuntimeHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    -discoverCapabilities(handle): Capabilities</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class SourceResolverRegistry {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +get(type): ISourceResolver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class ISourceResolver {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;&lt;interface&gt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +resolve(spec: ModuleSpec, auth: AuthProvider): ResolvedSource</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class GitResolver { +resolve() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class NpmResolver { +resolve() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class PyPIResolver { +resolve() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class DockerResolver { +resolve() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class LocalResolver { +resolve() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class RemoteResolver { +resolve() }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class RepoCache { +materialize(source): Path }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class ArtifactStore { +put(blob): CID +get(CID): Blob }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class DependencyInstaller {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +installNode(path): InstallResult</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +installPython(path): InstallResult</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +prepareDocker(image): InstallResult</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class ServerTypeDetector { +detect(path): ServerType }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class RuntimeOrchestrator {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +startNode(entry, env): RuntimeHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +startPython(entry, env): RuntimeHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +startDocker(image, env): RuntimeHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +connectRemote(endpoint, auth): RuntimeHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class IProcessManager {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;&lt;interface&gt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +spawn(cmd, args, opts): ProcessHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +signals: Signals</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class NodeProcessManager { +spawn() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class PythonProcessManager { +spawn() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class DockerProcessManager { +spawn() }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class MCPTransport {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;&lt;interface&gt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +open(handle): Connection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +send(msg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +onMessage(cb)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +close()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class StdioTransport { +open() }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class WebSocketTransport { +open() }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class CapabilityAggregator { +register(serverId, caps) +lookup(query) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class CapabilityRegistry { +tools +resources +prompts }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class ServerSupervisor {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +start()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +stop()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +restart()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +state: ServerState</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +events: EventEmitter</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class HealthMonitor {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +probe()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +heartbeat()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +backoffPolicy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class ServerRegistry { +add() +update() +remove() +getById() }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class AuthProvider {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +forSource(spec): Credentials</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +forRuntime(serverId): EnvSecrets</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +dockerAuth(): DockerCreds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class PlatformAdapter {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +paths</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +env</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +signals</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    +osInfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; SourceResolverRegistry : uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  SourceResolverRegistry --&gt; ISourceResolver : returns</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ISourceResolver &lt;|.. GitResolver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ISourceResolver &lt;|.. NpmResolver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ISourceResolver &lt;|.. PyPIResolver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ISourceResolver &lt;|.. DockerResolver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ISourceResolver &lt;|.. LocalResolver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ISourceResolver &lt;|.. RemoteResolver</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; RepoCache : caches</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; ArtifactStore : stores</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; DependencyInstaller : installs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; ServerTypeDetector : detects</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; RuntimeOrchestrator : provisions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; MCPTransport : binds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; CapabilityAggregator : registers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; ServerRegistry : records</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; AuthProvider : obtains creds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ModuleLoader --&gt; PlatformAdapter : cross‑platform</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  RuntimeOrchestrator --&gt; IProcessManager : uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  IProcessManager &lt;|.. NodeProcessManager</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  IProcessManager &lt;|.. PythonProcessManager</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  IProcessManager &lt;|.. DockerProcessManager</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  CapabilityAggregator --&gt; CapabilityRegistry : manages</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ServerSupervisor --&gt; HealthMonitor : monitors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ServerSupervisor --&gt; RuntimeOrchestrator : controls</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ServerSupervisor --&gt; ServerRegistry : updates</span></span></code></pre></div><hr><h2 id="module-loading-multi-source" tabindex="-1">Module Loading (Multi-Source) <a class="header-anchor" href="#module-loading-multi-source" aria-label="Permalink to &quot;Module Loading (Multi-Source)&quot;">​</a></h2><p>Supported source types and resolution rules:</p><ul><li>git: <code>git+https://host/org/repo[.git]#ref[:subdir]</code> (token via <code>AuthProvider</code>); shallow clone by default; content hash used for cache key</li><li>npm: <code>npm:package@version</code> (scoped supported); resolves tarball via registry API; installs under isolated store</li><li>pypi: <code>pypi:package==version</code> (wheel or sdist); installs into per-server virtualenv</li><li>docker: <code>docker:image[:tag@digest]</code> (pull via registry with optional auth)</li><li>local: <code>file:/abs/path</code> or workspace-relative path</li><li>remote: <code>remote:wss://endpoint</code> (no fetch/install; direct connect)</li></ul><p>Module specification (normalized example):</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-mcp/faq-bot&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;git&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://github.com/org/repo.git&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;ref&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;v1.2.3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;subdir&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;servers/faq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;runtime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;preferred&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;remote&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;entry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bin/server.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;nodeVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&gt;=18&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;entry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-m faq_server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;python&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&gt;=3.10&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;org/faq:1.2.3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;remote&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;endpoint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;wss://mcp.org/faq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;sourceScopes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;git:read&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;runtimeSecrets&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;FAQ_API_KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;registry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;npm:read&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;health&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;probe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;list_tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;intervalMs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;restartPolicy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;maxRestarts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;backoff&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;exponential&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;baseMs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;capabilities&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;namespace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;faq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;aliases&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;ask&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;faq.ask&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Source resolvers produce a <code>ResolvedSource</code> with:</p><ul><li><code>cacheKey</code> (content hash including source URL, ref, lockfiles)</li><li><code>path</code> or <code>image</code> or <code>endpoint</code></li><li><code>metadata</code> (license, README, manifest data)</li></ul><p>Dependency installation yields an <code>InstallResult</code> with isolated path(s), environment variables, and entrypoint resolution.</p><hr><h2 id="process-management-abstraction-node-js-vs-workers" tabindex="-1">Process Management Abstraction (Node.js vs Workers) <a class="header-anchor" href="#process-management-abstraction-node-js-vs-workers" aria-label="Permalink to &quot;Process Management Abstraction (Node.js vs Workers)&quot;">​</a></h2><ul><li>Local processes: via <code>IProcessManager</code> with consistent spawn/IO/signals across OSes <ul><li>Node: <code>node entry.js</code> or <code>node -e</code> with resolved entry; supports <code>stdio</code> transport</li><li>Python: <code>python -m module</code> with per-server virtualenv activation; <code>stdio</code> transport</li><li>Docker: <code>docker run --rm ...</code> with mapped IO; optional TCP/WebSocket transport</li></ul></li><li>Remote runtimes (Workers/HTTP services): via <code>IRemoteEndpoint</code> behind <code>RuntimeOrchestrator</code><ul><li>WebSocket endpoints: <code>WebSocketTransport</code></li><li>HTTP/TCP bridges: optional adapter translating MCP over web transports</li></ul></li></ul><p>Runtime selection order is configurable (<code>runtime.preferred</code>). The <code>ServerTypeDetector</code> can override if a manifest explicitly declares a type.</p><hr><h2 id="capability-discovery-and-aggregation" tabindex="-1">Capability Discovery and Aggregation <a class="header-anchor" href="#capability-discovery-and-aggregation" aria-label="Permalink to &quot;Capability Discovery and Aggregation&quot;">​</a></h2><ul><li>Discovery: After establishing MCP connection, call discovery methods (e.g., <code>list_tools</code>, <code>list_resources</code>, <code>list_prompts</code>) and subscribe to server capability change events if available</li><li>Aggregation: <code>CapabilityAggregator</code> writes into a typed <code>CapabilityRegistry</code> with: <ul><li>Namespacing: <code>serverId:toolName</code> or configured <code>namespace.tool</code></li><li>Aliases: optional friendly names scoped to a workspace</li><li>Conflict resolution: policy-based (prefer explicit alias, else fail on collision)</li><li>Filtering: capabilities gated by access control and feature flags</li></ul></li><li>Query: unified lookup by name, namespace, type, or tags; supports partial matches and composition</li></ul><p>Capability graph encodes dependencies (e.g., tool uses resource) to enable impact analysis and smarter routing.</p><hr><h2 id="server-lifecycle-management" tabindex="-1">Server Lifecycle Management <a class="header-anchor" href="#server-lifecycle-management" aria-label="Permalink to &quot;Server Lifecycle Management&quot;">​</a></h2><p>States: <code>Uninstalled → Installed → Starting → Running → Unhealthy → Stopping → Stopped → Failed</code>.</p><ul><li><code>ServerSupervisor</code> owns a single server instance lifecycle <ul><li>Start: installs (if needed), provisions runtime, attaches transport, discovers capabilities, registers</li><li>Stop: drains, sends graceful termination signal, tears down processes, updates registry</li><li>Restart: policy-driven (on crash, on config change, on health failure), with bounded backoff</li><li>Update: re-resolve source at new ref/version; blue/green or restart-in-place</li></ul></li><li><code>ServerRegistry</code> tracks state, PID/handle, capabilities snapshot, metrics, and last errors</li><li>Structured events: <code>server.started</code>, <code>server.capabilities.updated</code>, <code>server.crashed</code>, <code>server.restarted</code>, <code>server.stopped</code></li></ul><hr><h2 id="health-monitoring-and-failure-recovery" tabindex="-1">Health Monitoring and Failure Recovery <a class="header-anchor" href="#health-monitoring-and-failure-recovery" aria-label="Permalink to &quot;Health Monitoring and Failure Recovery&quot;">​</a></h2><p>Health strategies (configurable per server):</p><ul><li>Heartbeat: periodic <code>list_tools</code> or dedicated <code>ping</code> method; timeouts mark Unhealthy</li><li>Process liveness: for local runtimes, process exit/crash detection</li><li>Transport keepalive: WebSocket/TCP ping/pong; reconnect on transient network errors</li><li>Readiness gates: wait for first capability snapshot before declaring Running</li></ul><p>Recovery:</p><ul><li>Retry policies: constant/exponential backoff with jitter; <code>maxRestarts</code> and <code>resetWindow</code></li><li>Circuit breaker: trip after consecutive failures; require manual intervention or time-based half-open trial</li><li>Quarantine: isolate a repeatedly failing server from aggregator so it does not disrupt routing</li><li>Telemetry hooks: emit counters, timings, and traces for probes and restarts; surface in operator UI/logs</li></ul><hr><h2 id="cross-platform-compatibility-design" tabindex="-1">Cross-Platform Compatibility Design <a class="header-anchor" href="#cross-platform-compatibility-design" aria-label="Permalink to &quot;Cross-Platform Compatibility Design&quot;">​</a></h2><ul><li><code>PlatformAdapter</code> encapsulates: <ul><li>Path handling (path separators, quoting, long path support on Windows)</li><li>Environment and encoding (UTF-8 stdio, locale)</li><li>Signals and termination semantics (SIGTERM/SIGINT on Unix, CTRL_BREAK on Windows)</li><li>Shell invocation differences and escaping</li><li>Proxy settings and CA bundles for outbound network</li></ul></li><li>No global state: per-server working directories under a managed root, with permissions tightened by platform</li><li>Optional portable Node/Python distributions when host lacks required versions (downloaded once into cache)</li></ul><hr><h2 id="server-type-detection-and-runtime-selection" tabindex="-1">Server Type Detection and Runtime Selection <a class="header-anchor" href="#server-type-detection-and-runtime-selection" aria-label="Permalink to &quot;Server Type Detection and Runtime Selection&quot;">​</a></h2><p>Detection heuristics (highest-confidence wins):</p><ul><li>Manifest: <code>mcp.json</code> or <code>package.json&quot;mcp&quot;</code> or <code>pyproject.toml</code> entry point group <code>mcp_server</code></li><li>Entrypoint presence: Node bin scripts; Python console_scripts or modules</li><li>Dockerfile or image provided; remote endpoint provided</li><li>Language-specific lockfiles: <code>package-lock.json/pnpm-lock.yaml</code> (Node), <code>poetry.lock/requirements.txt</code> (Python)</li></ul><p>Selection rules:</p><ul><li>If manifest declares runtime, honor and verify</li><li>Else prefer configured order and verify entrypoint exists per runtime</li><li>Fallback to remote if local install fails and remote is available (policy-gated)</li></ul><hr><h2 id="repository-management-and-dependency-handling" tabindex="-1">Repository Management and Dependency Handling <a class="header-anchor" href="#repository-management-and-dependency-handling" aria-label="Permalink to &quot;Repository Management and Dependency Handling&quot;">​</a></h2><ul><li>Isolation per server: <ul><li>Node: install under <code>.../.stores/node/&lt;cacheKey&gt;</code> using <code>npm ci</code> or <code>pnpm install --frozen-lockfile</code>; optionally <code>--ignore-scripts</code> with allowlist for safe postinstall</li><li>Python: create venv under <code>.../.stores/py/&lt;cacheKey&gt;</code>; <code>pip install -r requirements.txt</code> or <code>pip install .</code> with hashes when available</li><li>Docker: pull by digest; validate image signature when policy requires</li></ul></li><li>Caching: <ul><li><code>RepoCache</code> materializes sources keyed by content hash (URL+ref+lockfiles)</li><li><code>ArtifactStore</code> for built assets (e.g., compiled TypeScript) if build is separated</li></ul></li><li>Reproducibility: <ul><li>Prefer lockfiles; verify engines/python versions; fail with actionable message if mismatch</li><li>Optional SBOM ingestion to surface license/compliance</li></ul></li><li>Security: <ul><li>Run installs as non-root; restrict network during build if feasible</li><li>Validate checksums/digests; enforce minimum provenance for remote artifacts</li></ul></li></ul><hr><h2 id="authentication-integration-phase-2" tabindex="-1">Authentication Integration (Phase 2) <a class="header-anchor" href="#authentication-integration-phase-2" aria-label="Permalink to &quot;Authentication Integration (Phase 2)&quot;">​</a></h2><ul><li><code>AuthProvider</code> responsibilities: <ul><li>Source credentials: Git (HTTPS tokens/SSH keys), npm tokens, PyPI API tokens, Docker registry credentials</li><li>Runtime secrets: environment variables injected into server process or sent as secure MCP initialization params</li><li>Session tokens for remote endpoints (Workers) with rotation/refresh</li></ul></li><li>Secret handling: <ul><li>Least privilege, per-server scoping; never write secrets to disk unencrypted</li><li>Redaction in logs and events; explicit consent required to echo configs containing secrets</li></ul></li><li>Policy: <ul><li>Capability-level access control in <code>CapabilityAggregator</code> (filtering based on user/session scope)</li></ul></li></ul><hr><h2 id="sequence-diagrams" tabindex="-1">Sequence Diagrams <a class="header-anchor" href="#sequence-diagrams" aria-label="Permalink to &quot;Sequence Diagrams&quot;">​</a></h2><h3 id="server-loading-resolve-→-run-→-discover" tabindex="-1">Server Loading (Resolve → Run → Discover) <a class="header-anchor" href="#server-loading-resolve-→-run-→-discover" aria-label="Permalink to &quot;Server Loading (Resolve → Run → Discover)&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  autonumber</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant User</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant ModuleLoader as Loader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Resolver as SourceResolver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Cache as RepoCache</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Installer as DepInstaller</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Detector as TypeDetector</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Orchestrator as RuntimeOrchestrator</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Transport as MCPTransport</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Supervisor as ServerSupervisor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Aggregator as CapabilityAggregator</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Registry as ServerRegistry</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  User-&gt;&gt;Loader: load(ModuleSpec)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader-&gt;&gt;Resolver: resolve(spec, AuthProvider)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Resolver--&gt;&gt;Loader: ResolvedSource(path/image/endpoint, cacheKey)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader-&gt;&gt;Cache: materialize(ResolvedSource)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Cache--&gt;&gt;Loader: checkoutPath</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader-&gt;&gt;Installer: install(checkoutPath)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Installer--&gt;&gt;Loader: InstallResult(env, entrypoints)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader-&gt;&gt;Detector: detect(InstallResult)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Detector--&gt;&gt;Loader: ServerType(node/python/docker/remote)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader-&gt;&gt;Orchestrator: start(type, entry, env)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Orchestrator--&gt;&gt;Loader: RuntimeHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader-&gt;&gt;Transport: open(RuntimeHandle)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Transport--&gt;&gt;Loader: Connection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader-&gt;&gt;Supervisor: handoff(Connection, policy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Supervisor-&gt;&gt;Transport: discover(list_tools/resources/prompts)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Transport--&gt;&gt;Supervisor: Capabilities</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Supervisor-&gt;&gt;Aggregator: register(serverId, Capabilities)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Supervisor-&gt;&gt;Registry: record(state=Running)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Loader--&gt;&gt;User: ServerRecord(serverId, state=Running)</span></span></code></pre></div><h3 id="capability-discovery-and-update" tabindex="-1">Capability Discovery and Update <a class="header-anchor" href="#capability-discovery-and-update" aria-label="Permalink to &quot;Capability Discovery and Update&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  autonumber</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Supervisor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Transport</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Aggregator</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Registry</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  loop on interval or change event</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Supervisor-&gt;&gt;Transport: list_tools/list_resources/list_prompts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Transport--&gt;&gt;Supervisor: CapabilitiesDelta</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Supervisor-&gt;&gt;Aggregator: applyDelta(serverId, CapabilitiesDelta)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Aggregator-&gt;&gt;Registry: updateSnapshot(serverId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  end</span></span></code></pre></div><h3 id="health-probe-and-auto-recovery" tabindex="-1">Health Probe and Auto-Recovery <a class="header-anchor" href="#health-probe-and-auto-recovery" aria-label="Permalink to &quot;Health Probe and Auto-Recovery&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  autonumber</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Supervisor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Health as HealthMonitor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Orchestrator</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  participant Registry</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  loop every health.interval</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Supervisor-&gt;&gt;Health: probe()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    alt healthy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Health--&gt;&gt;Supervisor: ok</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    else timeout/error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Health--&gt;&gt;Supervisor: fail(reason)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Supervisor-&gt;&gt;Registry: state=Unhealthy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Supervisor-&gt;&gt;Orchestrator: restart(with backoff)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Orchestrator--&gt;&gt;Supervisor: RuntimeHandle</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Supervisor-&gt;&gt;Registry: state=Running</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  end</span></span></code></pre></div><hr><h2 id="runtime-transport-matrix" tabindex="-1">Runtime/Transport Matrix <a class="header-anchor" href="#runtime-transport-matrix" aria-label="Permalink to &quot;Runtime/Transport Matrix&quot;">​</a></h2><ul><li>Node: <code>StdioTransport</code> over spawned process stdio</li><li>Python: <code>StdioTransport</code> over venv-spawned process stdio</li><li>Docker: <code>StdioTransport</code> via <code>docker run</code> attach; or TCP/WebSocket depending on image</li><li>Remote (Workers): <code>WebSocketTransport</code> (preferred) or HTTP bridge</li></ul><p>Transports provide a consistent <code>Connection</code> event API and backpressure handling.</p><hr><h2 id="configuration-and-policies" tabindex="-1">Configuration and Policies <a class="header-anchor" href="#configuration-and-policies" aria-label="Permalink to &quot;Configuration and Policies&quot;">​</a></h2><ul><li>Global policy toggles: allow remote fallback, max concurrent servers, per-server CPU/memory limits (where supported)</li><li>Per-server policy: restart strategy, health strategy, capability visibility, aliasing, namespace</li><li>Observability: log levels per component, tracing toggles, metrics sinks</li></ul><hr><h2 id="testability-strategy" tabindex="-1">Testability Strategy <a class="header-anchor" href="#testability-strategy" aria-label="Permalink to &quot;Testability Strategy&quot;">​</a></h2><ul><li>Replaceable interfaces: in-memory <code>RepoCache</code>, fake <code>ISourceResolver</code>, stub <code>IProcessManager</code>, mock <code>MCPTransport</code></li><li>Deterministic tests: fixed clock/backoff; ephemeral temp dirs</li><li>Contract tests for resolvers and runtime managers per platform</li></ul><hr><h2 id="minimal-pseudocode-sketch" tabindex="-1">Minimal Pseudocode Sketch <a class="header-anchor" href="#minimal-pseudocode-sketch" aria-label="Permalink to &quot;Minimal Pseudocode Sketch&quot;">​</a></h2><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">spec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ModuleSpec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ServerRecord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resolver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resolvers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec.source.type)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resolved</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resolver.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec, auth)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> checkout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cache.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">materialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resolved)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> install</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> deps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(checkout, spec)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> runtimeType</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> detector.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">detect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(install, spec)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orchestrator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(runtimeType, install.entry, install.env)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> conn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transport.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handle)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> supervisor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServerSupervisor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(handle, conn, spec.health)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> caps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> supervisor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initialDiscover</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aggregator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec.id, caps)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  registry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec.id, { state: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Running&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handle, caps })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  supervisor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">beginMonitoring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> registry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec.id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="scalability-considerations" tabindex="-1">Scalability Considerations <a class="header-anchor" href="#scalability-considerations" aria-label="Permalink to &quot;Scalability Considerations&quot;">​</a></h2><ul><li>Concurrency control: semaphore on installs and startups; per-language worker pools</li><li>Sharding: group servers by runtime type to minimize hot caches; isolate heavy Docker pulls</li><li>Backpressure: limit discovery frequency; delta-based capability updates; lazy load non-critical servers</li></ul><hr><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>This architecture introduces a modular, testable system for loading MCP servers from diverse sources, running them across local and remote runtimes, and composing their capabilities behind a single Master. It integrates with Phase 2 authentication to securely access sources and inject runtime secrets, provides robust lifecycle supervision with health monitoring and recovery, and abstracts platform differences to run consistently on macOS, Linux, and Windows.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>Last updated: <time datetime="2025-08-15T18:11:40.000Z" data-v-e98dd255></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"advanced_extensibility.md\":\"TrXUn5w5\",\"advanced_index.md\":\"CPcpUlw_\",\"advanced_monitoring.md\":\"DTybdNg-\",\"advanced_performance.md\":\"DKmzK0ia\",\"advanced_security.md\":\"B-oBD7IB\",\"api_index.md\":\"Dl1JB08_\",\"api_readme.md\":\"DZxYTr9n\",\"architecture_phase1-architecture.md\":\"Bwa0Iy7O\",\"architecture_phase10-deployment-architecture.md\":\"C9TzxNCU\",\"architecture_phase11-documentation-architecture.md\":\"BBRumbvu\",\"architecture_phase2-architecture.md\":\"CZ5Rgg-j\",\"architecture_phase3-architecture.md\":\"CTSlHc-B\",\"architecture_phase4-architecture.md\":\"B852juNz\",\"architecture_phase5-architecture.md\":\"DilLkoS7\",\"architecture_phase6-architecture.md\":\"rotMaCW8\",\"architecture_phase7-architecture.md\":\"Bh7Otovi\",\"architecture_phase8-architecture.md\":\"Bg1m_5r_\",\"configuration_environment-variables.md\":\"Ddy3P_Wz\",\"configuration_environment.md\":\"DxcTQ623\",\"configuration_examples.md\":\"Bab8yt7b\",\"configuration_overview.md\":\"DIkVDv7V\",\"configuration_performance.md\":\"DbJdmLrW\",\"configuration_reference.md\":\"27IKWqtk\",\"configuration_security.md\":\"-OOlkzN4\",\"contributing_dev-setup.md\":\"Ceqh4w-R\",\"contributing_guidelines.md\":\"ZEAX2yVh\",\"contributing_index.md\":\"DYq9R6wr\",\"contributing_maintenance.md\":\"k2bR0IaR\",\"deployment_cicd.md\":\"Ci2T0UYC\",\"deployment_cloudflare-workers.md\":\"D2WHsfep\",\"deployment_docker.md\":\"B8bQDQTo\",\"deployment_index.md\":\"ClYeOkpy\",\"deployment_koyeb.md\":\"B_wJhvF7\",\"examples_advanced-routing.md\":\"B3CqhLZ7\",\"examples_basic-node.md\":\"CaDZzGlO\",\"examples_cloudflare-worker.md\":\"DwVSz-c7\",\"examples_index.md\":\"CBF_BLkl\",\"examples_oauth-delegation.md\":\"1hZxoqDl\",\"examples_overview.md\":\"CZN0JbZ7\",\"examples_testing.md\":\"Dek4GpNs\",\"getting-started.md\":\"DG9ndneo\",\"getting-started_concepts.md\":\"D7ON9iGB\",\"getting-started_installation.md\":\"BKnVqAGg\",\"getting-started_overview.md\":\"DvJDFL2N\",\"getting-started_quick-start.md\":\"BAboD7TN\",\"getting-started_quickstart-node.md\":\"GOO4aGas\",\"getting-started_quickstart-workers.md\":\"Cpofh8Mj\",\"guides_authentication.md\":\"BF_rmNNl\",\"guides_client-integration.md\":\"BDL0xQeg\",\"guides_configuration-management.md\":\"B-jwYMbA\",\"guides_configuration.md\":\"Ci3zYDFA\",\"guides_index.md\":\"CIlq2fmx\",\"guides_module-loading.md\":\"BkJvuRnQ\",\"guides_oauth-delegation.md\":\"DEOZ-_G0\",\"guides_request-routing.md\":\"Bdzf0VLg\",\"guides_server-management.md\":\"CdBNYUri\",\"guides_server-sharing.md\":\"CF9KXOB0\",\"guides_testing.md\":\"kYfHqJLu\",\"index.md\":\"H2oHgda-\",\"phase-11_phase-11-research-and-docs-plan.md\":\"DQXXtaI4\",\"readme.md\":\"BO5r5M9u\",\"reports_mcp-compliance-audit.md\":\"DvwrAmVA\",\"research_phase1-analysis.md\":\"CDS2u6i0\",\"research_phase2-analysis.md\":\"YFIYQ8ED\",\"research_phase3-analysis.md\":\"6-kwQIco\",\"research_phase4-analysis.md\":\"Cjwqrpc1\",\"research_phase5-analysis.md\":\"DUgNDwCY\",\"research_phase6-analysis.md\":\"D_7kWjvM\",\"research_phase7-analysis.md\":\"C_JufIBV\",\"research_phase8-analysis.md\":\"VqlhbJUi\",\"review_phase1-self-critique.md\":\"BR9mHtP8\",\"review_phase3-self-critique.md\":\"CNeeAB1q\",\"review_phase4-routing-evaluation.md\":\"Q1RDwX8b\",\"review_phase4-self-critique.md\":\"BahYGljk\",\"review_phase5-self-critique.md\":\"DEWce8pj\",\"review_phase6-evaluation.md\":\"B8OWioNv\",\"review_phase6-self-critique.md\":\"LUVIwJt5\",\"review_phase7-self-critique.md\":\"D5QXsZd1\",\"testing_phase-9-testing-architecture.md\":\"ah52XEOW\",\"troubleshooting_common-issues.md\":\"CScvzWM1\",\"troubleshooting_deployment.md\":\"DUhpqnLE\",\"troubleshooting_errors.md\":\"BSCsEmGc\",\"troubleshooting_index.md\":\"CX5c9Zq5\",\"troubleshooting_oauth.md\":\"Cw60Eka3\",\"troubleshooting_performance.md\":\"DxY6LJcT\",\"troubleshooting_routing.md\":\"BHN-MDhs\",\"troubleshooting_security-best-practices.md\":\"Yiu8E-zt\",\"tutorials_beginner-getting-started.md\":\"BXObgobW\",\"tutorials_cloudflare-workers-tutorial.md\":\"MPHsc0aT\",\"tutorials_load-balancing-and-resilience.md\":\"Dv9r9jyW\",\"tutorials_oauth-delegation-github.md\":\"Nq4glqCe\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Master MCP Server\",\"description\":\"Aggregate and orchestrate multiple MCP servers behind one endpoint\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"siteTitle\":\"Master MCP Server\",\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/your-org/master-mcp-server\"}],\"outline\":[2,6],\"nav\":[{\"text\":\"Getting Started\",\"link\":\"/getting-started/overview\"},{\"text\":\"Guides\",\"link\":\"/guides/index\"},{\"text\":\"API\",\"link\":\"/api/index\"},{\"text\":\"Configuration\",\"link\":\"/configuration/overview\"},{\"text\":\"Deployment\",\"link\":\"/deployment/index\"},{\"text\":\"Examples\",\"link\":\"/examples/index\"},{\"text\":\"Advanced\",\"link\":\"/advanced/index\"},{\"text\":\"Troubleshooting\",\"link\":\"/troubleshooting/index\"},{\"text\":\"Contributing\",\"link\":\"/contributing/index\"}],\"sidebar\":{\"/getting-started/\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Overview\",\"link\":\"/getting-started/overview\"},{\"text\":\"Installation\",\"link\":\"/getting-started/installation\"},{\"text\":\"Quick Start\",\"link\":\"/getting-started/quick-start\"},{\"text\":\"Quickstart (Node)\",\"link\":\"/getting-started/quickstart-node\"},{\"text\":\"Quickstart (Workers)\",\"link\":\"/getting-started/quickstart-workers\"},{\"text\":\"Core Concepts\",\"link\":\"/getting-started/concepts\"}]}],\"/guides/\":[{\"text\":\"User Guides\",\"items\":[{\"text\":\"Authentication\",\"link\":\"/guides/authentication\"},{\"text\":\"OAuth Delegation\",\"link\":\"/guides/oauth-delegation\"},{\"text\":\"Client Integration\",\"link\":\"/guides/client-integration\"},{\"text\":\"Server Sharing\",\"link\":\"/guides/server-sharing\"},{\"text\":\"Module Loading\",\"link\":\"/guides/module-loading\"},{\"text\":\"Request Routing\",\"link\":\"/guides/request-routing\"},{\"text\":\"Configuration\",\"link\":\"/guides/configuration\"},{\"text\":\"Testing Strategy\",\"link\":\"/guides/testing\"}]}],\"/api/\":[{\"text\":\"API Reference\",\"items\":[{\"text\":\"Overview\",\"link\":\"/api/index\"},{\"text\":\"Types\",\"link\":\"/api/reference/modules\"}]}],\"/configuration/\":[{\"text\":\"Configuration\",\"items\":[{\"text\":\"Overview\",\"link\":\"/configuration/overview\"},{\"text\":\"Reference\",\"link\":\"/configuration/reference\"},{\"text\":\"Examples\",\"link\":\"/configuration/examples\"},{\"text\":\"Environment Variables\",\"link\":\"/configuration/environment\"}]}],\"/deployment/\":[{\"text\":\"Deployment\",\"items\":[{\"text\":\"Overview\",\"link\":\"/deployment/index\"},{\"text\":\"Docker\",\"link\":\"/deployment/docker\"},{\"text\":\"Cloudflare Workers\",\"link\":\"/deployment/cloudflare-workers\"},{\"text\":\"Koyeb\",\"link\":\"/deployment/koyeb\"}]}],\"/examples/\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Index\",\"link\":\"/examples/index\"},{\"text\":\"Basic Node Aggregator\",\"link\":\"/examples/basic-node\"},{\"text\":\"Cloudflare Worker\",\"link\":\"/examples/cloudflare-worker\"},{\"text\":\"Advanced Routing\",\"link\":\"/examples/advanced-routing\"},{\"text\":\"OAuth Delegation\",\"link\":\"/examples/oauth-delegation\"},{\"text\":\"Testing Patterns\",\"link\":\"/examples/testing\"}]}],\"/advanced/\":[{\"text\":\"Advanced Topics\",\"items\":[{\"text\":\"Security Hardening\",\"link\":\"/advanced/security\"},{\"text\":\"Performance & Scalability\",\"link\":\"/advanced/performance\"},{\"text\":\"Monitoring & Logging\",\"link\":\"/advanced/monitoring\"},{\"text\":\"Extensibility & Plugins\",\"link\":\"/advanced/extensibility\"}]}],\"/troubleshooting/\":[{\"text\":\"Troubleshooting\",\"items\":[{\"text\":\"Common Issues\",\"link\":\"/troubleshooting/index\"},{\"text\":\"OAuth & Tokens\",\"link\":\"/troubleshooting/oauth\"},{\"text\":\"Routing & Modules\",\"link\":\"/troubleshooting/routing\"},{\"text\":\"Deployment\",\"link\":\"/troubleshooting/deployment\"}]}],\"/contributing/\":[{\"text\":\"Contributing\",\"items\":[{\"text\":\"Overview\",\"link\":\"/contributing/index\"},{\"text\":\"Development Setup\",\"link\":\"/contributing/dev-setup\"},{\"text\":\"Coding & Docs Guidelines\",\"link\":\"/contributing/guidelines\"}]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>